<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Wishlist</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f7f7f7;
      padding: 40px;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    .wishlist-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
    }
    .wishlist-card {
      background: #fff;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0px 3px 10px rgba(0,0,0,0.1);
      text-align: center;
    }
    .wishlist-card img {
      width: 100%;
      height: 180px;
      object-fit: cover;
      border-radius: 8px;
    }
    .wishlist-card h3 {
      margin: 10px 0 5px;
      font-size: 16px;
      color: #333;
    }
    .wishlist-card p {
      font-size: 14px;
      color: #666;
      line-height: 1.3;
    }
  </style>
</head>
<body>
  <h1>My Wishlist</h1>
  <div class="wishlist-grid" id="wishlist-container">
    <!-- Wishlist items will load here -->
     
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, query, where, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBnBjnfbt2N6LHxBVkSMmEuu_51JI0NHzI",
      authDomain: "artisan-3b8d6.firebaseapp.com",
      projectId: "artisan-3b8d6",
      storageBucket: "artisan-3b8d6.appspot.com",
      messagingSenderId: "63442588763",
      appId: "1:63442588763:web:72a583c2a6a1f26d63db7e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const customer_id = "cust_001"; // replace with real logged-in user

    function truncate(text, max = 120) {
      if (!text) return "";
      return text.length > max ? text.slice(0, max) + "â€¦" : text;
    }

    async function loadWishlist() {
      const container = document.getElementById("wishlist-container");
      container.innerHTML = "";

      try {
        // Query Wishlist for this customer
        const q = query(collection(db, "Wishlist"), where("customerId", "==", customer_id));
        const wishlistSnapshot = await getDocs(q);

        if (wishlistSnapshot.empty) {
          container.innerHTML = "<p style='text-align:center;'>No items in wishlist.</p>";
          return;
        }

        for (const wishDoc of wishlistSnapshot.docs) {
          const { productId } = wishDoc.data();

          // Fetch product info from 'posts' collection
          const productSnap = await getDoc(doc(db, "posts", productId));
          if (productSnap.exists()) {
            const product = productSnap.data();

            const card = document.createElement("div");
            card.className = "wishlist-card";
            card.innerHTML = `
              <img src="${product.imageUrl || ''}" alt="${product.productName || 'Product'}">
              <h3>${product.productName || 'Unnamed Product'}</h3>
              <p><i>${truncate(product.story)}</i></p>
            `;
            container.appendChild(card);
          }
        }

      } catch (err) {
        console.error("Error loading wishlist: ", err);
        container.innerHTML = "<p style='text-align:center;color:red;'>Error loading wishlist.</p>";
      }
    }

    document.addEventListener("DOMContentLoaded", loadWishlist);
  </script>
</body>
</html>
