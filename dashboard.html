<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>NGO Dashboard</title>
  <style>
    body {
      font-family: 'Georgia', serif;
      background: linear-gradient(135deg, #f6f1eb, #fff8f0);
      padding: 20px;
      color: #4b3f36;
      min-height: 100vh;
    }
    h1 {
      text-align: center;
      font-size: 2rem;
      color: #7b4e35;
      margin-bottom: 20px;
    }
    .artisan-list {
      max-width: 700px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }
    .artisan-card {
      background: #fff3eb;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 6px 15px rgba(123, 78, 53, 0.15);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .artisan-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 25px rgba(123, 78, 53, 0.2);
    }
    .artisan-card h3 {
      margin: 0 0 10px;
      font-size: 1.3rem;
      color: #7b4e35;
    }
    .artisan-card p {
      margin: 5px 0;
      color: #5a4639;
      line-height: 1.4;
    }
    .navbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #7b4e35;
      padding: 12px 24px;
      color: #fff;
    }
    .navbar .logo {
      font-weight: bold;
      font-size: 1.2rem;
    }
    .nav-links {
      list-style: none;
      display: flex;
      gap: 20px;
    }
    .nav-links li a {
      text-decoration: none;
      color: #fff;
      font-weight: 500;
    }
    .nav-links li a:hover {
      color: #f6f1eb;
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="logo">KalaArz</div>
    <ul class="nav-links">
      <li><a href="dashboard.html">Dashboard</a></li>
      <li><a href="catalog.html">Your Products</a></li>
      <li><a href="start-journey.html">Add Artisan</a></li>
      <li><a id="addProductLink" href="#" target="_blank">Add Product</a></li>
      <li><a href="https://kalaarz-2.onrender.com">Market Insights</a></li>
      <li><a href="home.html">Stories</a></li>
    </ul>
  </nav>

  <h1>Welcome to your Dashboard</h1>
  <center><h2>Your Artisans</h2></center>
  <div id="artisanList"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // ‚úÖ Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyBnBjnfbt2N6LHxBVkSMmEuu_51JI0NHzI",
  authDomain: "artisan-3b8d6.firebaseapp.com",
  databaseURL: "https://artisan-3b8d6-default-rtdb.firebaseio.com",
  projectId: "artisan-3b8d6",
  storageBucket: "artisan-3b8d6.firebasestorage.app",
  messagingSenderId: "63442588763",
  appId: "1:63442588763:web:72a583c2a6a1f26d63db7e",
  measurementId: "G-01922BTK99"
    };

    // ‚úÖ Init Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ‚úÖ Function to load artisans for this NGO
    async function loadArtisans(uid) {
      const artisanList = document.getElementById("artisanList");
      artisanList.innerHTML = "<p>Loading artisans...</p>";

      try {
        const artisansRef = collection(db, "NGOs", uid, "artisans");
        const querySnapshot = await getDocs(artisansRef);

        artisanList.innerHTML = "";
        if (querySnapshot.empty) {
          artisanList.innerHTML = "<p>No artisans found for your NGO.</p>";
          return;
        }

        querySnapshot.forEach((doc) => {
          const data = doc.data();
          const div = document.createElement("div");
          div.classList.add("artisan-card");
          div.innerHTML = `
            <h3>${data.name || "Unnamed"}</h3>
            <p>Age: ${data.age || "N/A"}</p>
            <p>${data.bio || data["background-story"] || ""}</p>
            <p>Craft: ${data.craft || ""}</p>
          `;
          artisanList.appendChild(div);
        });
      } catch (error) {
        console.error("‚ùå Error loading artisans:", error);
        artisanList.innerHTML = "<p style='color:red;'>Error loading artisans. Check console.</p>";
      }
    }

    // ‚úÖ Auth state listener
    onAuthStateChanged(auth, async (user) => {
      console.log("üîÑ Auth state changed:", user);

      if (user) {
        const uid = user.uid;
        console.log("‚úÖ NGO logged in:", uid);

        // Set Add Product link dynamically
        const addProductLink = document.getElementById("addProductLink");
        if (addProductLink) {
          addProductLink.href = `https://kala-arz-h00h.onrender.com/story?uid=${uid}`;
        }

        // Load artisans
        loadArtisans(uid);
      } else {
        alert("‚ö†Ô∏è Please log in as an NGO to manage products.");
        document.getElementById("artisanList").innerHTML =
          "<p style='color:red;'>Not logged in. Please go to login page.</p>";
      }
    });
  </script>
</body>
</html>

